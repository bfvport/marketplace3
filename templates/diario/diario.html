<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Diario | Marketplace Manager</title>

  <link rel="stylesheet" href="../../assets/css/app.css" />

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../assets/js/supabase.js"></script>

  <style>
    .card-section { margin-bottom: 16px; }

    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }

    .grid-3 {
      display:grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 12px;
    }

    .muted { opacity: .75; }

    .pill-row { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }

    .btn-drive {
      margin-top: 12px;
      padding: 12px 18px;
      border-radius: 10px;
      border: 1px solid rgba(59, 130, 246, 0.4);
      background: linear-gradient(135deg, #1e3a8a, #2563eb);
      color: #fff;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      width: 100%;
    }
    .btn-drive:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(37, 99, 235, 0.35);
    }
    .btn-drive:active { transform: scale(0.98); }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td {
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,.08);
      text-align: left;
      vertical-align: middle;
    }
    .actions { display:flex; gap:8px; justify-content:flex-end; flex-wrap:wrap; }

    input, textarea, select {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      color: #e5e7eb;
      outline: none;
    }
    textarea { min-height: 110px; resize: vertical; }

    .copy-grid {
      display:grid;
      grid-template-columns: 1fr auto;
      gap: 10px;
      align-items: start;
      margin-bottom: 10px;
    }

    .logbox {
      background: rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.10);
      border-radius: 12px;
      padding: 12px;
      max-height: 220px;
      overflow:auto;
      font-size: 13px;
      line-height: 1.45;
    }

    .hintline{
      margin-top:8px;
      font-size:13px;
      color: rgba(226,232,240,0.78);
    }
  </style>
</head>

<body>
  <div class="layout">
    <div id="sidebar-host"></div>

    <main class="content">
      <div style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <h1>üìí Diario</h1>
        <div class="muted" id="pill-hoy"></div>
      </div>

      <section class="card card-section">
        <h3 style="margin:0 0 8px;">üë§ Usuario</h3>
        <div id="userInfo" class="muted">Cargando...</div>
      </section>

      <section class="card card-section" id="driveSection">
        <h3 style="margin:0 0 6px;">üìÅ Contenido del d√≠a (Drive)</h3>
        <p class="muted" id="driveFecha" style="margin:0;">
          Descarg√° im√°genes/videos desde Drive seg√∫n la fecha de hoy.
        </p>
        <button id="btnAbrirDrive" class="btn-drive">Abrir carpeta de Drive</button>
        <div class="hintline">
          Drive es la √∫nica fuente de medios. El sistema solo guarda links + m√©tricas.
        </div>
      </section>

      <section class="card card-section">
        <h3 style="margin:0 0 8px;">üè∑Ô∏è Asignaci√≥n activa</h3>
        <div id="categoriaInfo" class="muted">Cargando...</div>

        <div class="pill-row" id="pillsMetas">
          <span class="pill pill-info">Meta total d√≠a: <strong id="metaTotalDia">0</strong></span>
          <span class="pill pill-success">Hechas hoy: <strong id="contadorPublicaciones">0</strong></span>
          <span class="pill pill-warning">Pendientes hoy: <strong id="pendientesHoy">0</strong></span>
        </div>

        <div id="pillsDetalle" class="pill-row" style="margin-top:10px;"></div>
      </section>

      <section class="card card-section">
        <h3 style="margin:0 0 10px;">üß≠ Qu√© est√°s registrando</h3>
        <div class="grid-3">
          <div>
            <label class="muted">Plataforma</label>
            <select id="plataformaSel">
              <option value="marketplace">Marketplace</option>
              <option value="facebook">Facebook</option>
              <option value="tiktok">TikTok</option>
            </select>
          </div>

          <div>
            <label class="muted">Tipo RRSS (solo Facebook)</label>
            <select id="tipoSel">
              <option value="">(no aplica)</option>
              <option value="muro">Muro</option>
              <option value="grupo">Grupo</option>
              <option value="historia">Historia</option>
              <option value="reel">Reel</option>
            </select>
          </div>

          <div>
            <label class="muted">Cuenta (seg√∫n plataforma)</label>
            <input id="cuentaSeleccionadaView" type="text" disabled placeholder="Seleccion√° una cuenta..." />
          </div>
        </div>

        <div class="hintline">
          Marketplace/TikTok guardan <span class="mono">plataforma</span> y link. Facebook adem√°s guarda <span class="mono">tipo_rrss</span>.
        </div>
      </section>

      <section class="card card-section">
        <h3 style="margin:0 0 10px;">üë§ Cuentas asignadas</h3>
        <table class="table" id="tablaCuentas">
          <thead>
            <tr class="muted">
              <th>Cuenta</th>
              <th>Plataforma</th>
              <th>Hoy</th>
              <th style="text-align:right;">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <div class="hintline muted">
          Si no aparecen cuentas: el gerente debe asignarlas en ‚ÄúCuentas‚Äù.
        </div>
      </section>

      <section class="card card-section" id="contenidoContainer" style="display:none;">
        <h3 style="margin:0 0 10px;">üìù Contenido para publicar</h3>

        <div id="csvInfo" class="muted" style="margin-bottom: 10px;"></div>

        <div class="copy-grid">
          <div>
            <label class="muted">T√≠tulo</label>
            <input id="tituloInput" type="text" placeholder="T√≠tulo..." />
          </div>
          <button class="btn2" id="btnCopiarTitulo" style="height:44px; margin-top:22px;">Copiar</button>
        </div>

        <div class="copy-grid">
          <div>
            <label class="muted">Descripci√≥n (de categor√≠a)</label>
            <textarea id="descripcionInput" placeholder="Descripci√≥n base..."></textarea>
          </div>
          <button class="btn2" id="btnCopiarDescripcion" style="height:44px; margin-top:22px;">Copiar</button>
        </div>

        <div class="grid-2">
          <div class="copy-grid" style="margin:0;">
            <div>
              <label class="muted">Categor√≠a</label>
              <input id="categoriaInput" type="text" placeholder="Categor√≠a..." />
            </div>
            <button class="btn2" id="btnCopiarCategoria" style="height:44px; margin-top:22px;">Copiar</button>
          </div>

          <div class="copy-grid" style="margin:0;">
            <div>
              <label class="muted">Etiquetas (categor√≠a + CSV)</label>
              <input id="etiquetasInput" type="text" placeholder="Etiquetas..." />
            </div>
            <button class="btn2" id="btnCopiarEtiquetas" style="height:44px; margin-top:22px;">Copiar</button>
          </div>
        </div>

        <hr style="border:0; border-top:1px solid rgba(255,255,255,.10); margin:16px 0;" />

        <h3 style="margin:0 0 10px;">‚úÖ Guardar publicaci√≥n</h3>

        <!-- Hidden inputs usados por el JS -->
        <input id="cuentaUsadaInput" type="hidden" />
        <input id="tituloUsadoInput" type="hidden" />
        <input id="descripcionUsadaInput" type="hidden" />
        <input id="categoriaUsadaInput" type="hidden" />
        <input id="etiquetasUsadasInput" type="hidden" />

        <div class="grid-2">
          <div>
            <label class="muted" id="linkLabel">Link de la publicaci√≥n</label>
            <input id="linkPublicacionInput" type="url" placeholder="https://..." />
          </div>
          <div>
            <label class="muted">Notas (opcional)</label>
            <input id="notaInput" type="text" placeholder="Ej: variante, detalle, etc." />
          </div>
        </div>

        <div style="display:flex; gap:10px; margin-top: 12px;">
          <button class="btn" id="btnGuardarPublicacion" style="flex:1;">Guardar</button>
          <button class="btn2" id="btnLimpiarFormulario">Limpiar</button>
        </div>
      </section>

      <section class="card card-section">
        <h3 style="margin:0 0 10px;">üìö Historial de hoy</h3>
        <table class="table" id="tablaHistorial">
          <thead>
            <tr class="muted">
              <th>Hora</th>
              <th>Plataforma</th>
              <th>Tipo</th>
              <th>Cuenta</th>
              <th>Link</th>
              <th style="text-align:right;">Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <section class="card card-section">
        <h3 style="margin:0 0 10px;">üßæ Log</h3>
        <div id="log" class="logbox"></div>
      </section>
    </main>
  </div>

  <script type="module" src="./diario.js"></script>
</body>
</html>
