<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üìî Diario de Publicaciones | Marketplace Manager</title>

  <link rel="stylesheet" href="../../assets/css/app.css" />

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../assets/js/supabase.js"></script>

  <style>
    .table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
    .table th, .table td { border-bottom: 1px solid rgba(255,255,255,0.12); padding: 10px 8px; vertical-align: top; }
    .table th { text-align:left; opacity: .85; }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    .small { font-size: 12px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size: 12px; }
    .pill { display:inline-block; padding: 4px 12px; border-radius: 999px; font-size: 12px; margin: 0 4px; }
    .pill-info { background: rgba(59, 130, 246, 0.15); color: #93c5fd; }
    .pill-success { background: rgba(34, 197, 94, 0.15); color: #86efac; }
    .pill-warning { background: rgba(234, 179, 8, 0.15); color: #fde047; }
    .pill-danger { background: rgba(239, 68, 68, 0.15); color: #fca5a5; }
    .counter { font-size: 24px; font-weight: bold; text-align: center; margin: 10px 0; }
    .counter-label { font-size: 12px; opacity: 0.8; }
    .image-preview { display: inline-block; margin: 5px; border: 1px solid rgba(255,255,255,0.2); border-radius: 4px; overflow: hidden; }
    .image-preview img { width: 80px; height: 80px; object-fit: cover; }
    .image-preview.used { opacity: 0.5; border-color: #ef4444 !important; }
    .image-preview.used img { filter: grayscale(100%); }
    .card-section { margin-bottom: 20px; }
    .row-inputs { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
    .row-inputs input, .row-inputs textarea { flex: 1; }
    .row-inputs textarea { min-height: 80px; resize: vertical; }
    .copied-feedback { color: #4ade80; font-size: 11px; margin-left: 5px; }
    .required::after { content: " *"; color: #ef4444; }
    .btn.active { background: rgba(34, 197, 94, 0.2) !important; border-color: #22c55e !important; }
    .content-border { border-left: 4px solid #3b82f6; padding-left: 10px; transition: all 0.3s ease; }
    .content-border.used { border-left-color: #ef4444; opacity: 0.6; }
    .content-border.selected { border-left-color: #22c55e; }
    .stats-container { display: flex; gap: 15px; margin-top: 10px; flex-wrap: wrap; }
    .stats-item { background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 6px; }
    .content-used-badge { display: inline-block; background: #ef4444; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-left: 8px; }
    .content-available-badge { display: inline-block; background: #22c55e; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-left: 8px; }
  </style>
</head>

<body>
  <div class="layout">
    <div id="sidebar-host"></div>

    <main class="content">
      <!-- Informaci√≥n del usuario y categor√≠a -->
      <div class="title">üìî Diario de Publicaciones</div>
      
      <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); margin-bottom: 20px;">
        <div class="card">
          <div style="font-weight:800;">üë§ Informaci√≥n del Operador</div>
          <div id="userInfo" class="muted">Cargando informaci√≥n del usuario...</div>
        </div>
        
        <div class="card">
          <div style="font-weight:800;">üìÇ Categor√≠a Asignada</div>
          <div id="categoriaInfo" class="muted">Cargando categor√≠a...</div>
        </div>
        
        <div class="card">
          <div style="font-weight:800;">üìä Progreso Diario</div>
          <div class="counter">
            <span id="contadorPublicaciones">0</span>/<span id="metaPublicaciones">0</span>
          </div>
          <div class="counter-label">Publicaciones realizadas / Meta diaria</div>
          <div class="stats-container">
            <div class="stats-item">
              <span class="muted small">Cuentas:</span>
              <strong id="contadorCuentas">0</strong>
            </div>
            <div class="stats-item">
              <span class="muted small">Completadas:</span>
              <strong id="contadorCompletadas">0</strong>
            </div>
          </div>
        </div>
      </div>

      <!-- Cuentas de Facebook asignadas -->
      <section class="card card-section">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="font-weight:800;">üì± Cuentas de Facebook Asignadas</div>
          <div class="muted small" id="cuentasInfo">Cargando cuentas...</div>
        </div>
        <div class="muted small">Seleccion√° una cuenta para comenzar a publicar</div>
        
        <table class="table" id="tablaCuentas">
          <thead>
            <tr>
              <th style="width:250px;">Email de la cuenta</th>
              <th style="width:150px;">Estado</th>
              <th style="width:120px;">Publicadas hoy</th>
              <th style="width:150px;">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="4" class="muted">Cargando cuentas...</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Contenido del CSV para publicar -->
      <section class="card card-section">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="font-weight:800;">üìÑ Contenido para Publicar</div>
          <div class="muted small" id="csvInfo">Seleccion√° una cuenta para comenzar</div>
        </div>
        
        <div class="stats-container" id="estadisticasContenido" style="display: none;">
          <!-- Las estad√≠sticas se cargar√°n aqu√≠ -->
        </div>
        
        <div id="contenidoContainer" style="display: none; margin-top: 15px;">
          <!-- Contenido actual con estado visual -->
          <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div>
              <label class="required">T√≠tulo</label>
              <div class="row-inputs">
                <input type="text" id="tituloInput" readonly class="content-border" style="background: rgba(255,255,255,0.06);">
                <button class="btn2" id="btnCopiarTitulo">Copiar</button>
              </div>
              
              <label class="required">Descripci√≥n</label>
              <div class="row-inputs" style="align-items: flex-start;">
                <textarea id="descripcionInput" readonly class="content-border" style="background: rgba(255,255,255,0.06); height: 120px;"></textarea>
                <button class="btn2" id="btnCopiarDescripcion">Copiar</button>
              </div>
              
              <label class="required">Categor√≠a (Facebook)</label>
              <div class="row-inputs">
                <input type="text" id="categoriaInput" readonly style="background: rgba(255,255,255,0.06);">
                <button class="btn2" id="btnCopiarCategoria">Copiar</button>
              </div>
              
              <label class="required">Etiquetas (desde categor√≠a)</label>
              <div class="row-inputs">
                <input type="text" id="etiquetasInput" readonly style="background: rgba(255,255,255,0.06);">
                <button class="btn2" id="btnCopiarEtiquetas">Copiar</button>
              </div>
            </div>
            
            <div>
              <label>Im√°genes Fijas (1-4)</label>
              <div id="imagenesFijasContainer" style="margin-bottom: 15px; display: flex; flex-wrap: wrap; gap: 10px; min-height: 100px;">
                <!-- Las im√°genes se cargar√°n aqu√≠ -->
              </div>
              
              <label class="required">Imagen de Portada</label>
              <div id="portadaContainer" style="margin-bottom: 15px; min-height: 100px;">
                <!-- La portada se cargar√° aqu√≠ -->
              </div>
              
              <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn2" id="btnDescargarTodasImagenes">‚¨áÔ∏è Descargar todas las im√°genes</button>
                <button class="btn2" id="btnCambiarContenido">üîÑ Cambiar contenido</button>
              </div>
              <div class="muted small" style="margin-top: 5px;">
                Descarga las 5 im√°genes (4 fijas + 1 portada) | Cambia a otro contenido disponible
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Formulario para guardar publicaci√≥n -->
      <section class="card card-section">
        <div style="font-weight:800;">üíæ Guardar Publicaci√≥n</div>
        <div class="muted small" style="margin-bottom: 15px;">
          Complet√° el link de Marketplace y guard√° la publicaci√≥n
        </div>
        
        <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
          <div>
            <label class="required">Cuenta Facebook usada</label>
            <input type="text" id="cuentaUsadaInput" readonly style="background: rgba(255,255,255,0.06);">
            
            <label class="required">T√≠tulo usado</label>
            <input type="text" id="tituloUsadoInput" readonly style="background: rgba(255,255,255,0.06);">
            
            <label class="required">Descripci√≥n usada</label>
            <textarea id="descripcionUsadaInput" readonly style="background: rgba(255,255,255,0.06); height: 100px;"></textarea>
          </div>
          
          <div>
            <label class="required">Categor√≠a usada</label>
            <input type="text" id="categoriaUsadaInput" readonly style="background: rgba(255,255,255,0.06);">
            
            <label>Etiquetas usadas</label>
            <input type="text" id="etiquetasUsadasInput" readonly style="background: rgba(255,255,255,0.06);">
            
            <label class="required">URL Imagen Portada</label>
            <input type="text" id="urlPortadaInput" readonly style="background: rgba(255,255,255,0.06);">
            
            <label class="required">üîó Link de Marketplace *</label>
            <input type="text" id="marketplaceLinkInput" placeholder="https://www.facebook.com/marketplace/item/...">
            <div class="muted small" style="color: #f59e0b; margin-top: 5px;">
              Este campo es <strong>OBLIGATORIO</strong> para guardar la publicaci√≥n
            </div>
            
            <div style="margin-top: 20px; display: flex; gap: 10px;">
              <button class="btn" id="btnGuardarPublicacion">üíæ Guardar Publicaci√≥n</button>
              <button class="btn2" id="btnLimpiarLink">Limpiar Link</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Historial de publicaciones de hoy -->
      <section class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
          <div style="font-weight:800;">üìã Historial de Publicaciones de Hoy</div>
          <div class="muted small" id="historialInfo"></div>
        </div>
        
        <table class="table" id="tablaHistorial">
          <thead>
            <tr>
              <th style="width:150px;">Hora</th>
              <th style="width:200px;">Cuenta Facebook</th>
              <th>T√≠tulo</th>
              <th style="width:200px;">Link Marketplace</th>
              <th style="width:100px;">Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="5" class="muted">Cargando historial...</td></tr>
          </tbody>
        </table>
      </section>

      <!-- Logs -->
      <div style="margin-top: 20px;">
        <div style="font-weight:700; margin-bottom:8px; display: flex; justify-content: space-between; align-items: center;">
          <span>üñ•Ô∏è Logs del Sistema</span>
          <button class="btn2" id="btnLimpiarLogs" style="font-size: 11px;">Limpiar logs</button>
        </div>
        <div class="log" id="log"></div>
      </div>
    </main>
  </div>

  <script type="module" src="./diario.js"></script>
</body>
</html>