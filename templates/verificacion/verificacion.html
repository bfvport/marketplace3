<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VerificaciÃ³n | Marketplace Manager</title>

  <link rel="stylesheet" href="../../assets/css/app.css" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="../../assets/js/supabase.js"></script>
</head>

<body>
  <!-- âœ… Sidebar -->
  <div id="sidebar-host"></div>

  <!-- âœ… Contenido -->
  <main class="main-content">
    <div class="container">
      <h1 style="margin-top:10px;">ðŸ”Ž VerificaciÃ³n</h1>
      <p class="muted">Solo gerente. Operador no entra.</p>

      <div class="card" style="padding:16px; margin-top:12px;">
        <label class="muted">Fecha</label>
        <input id="filtro-fecha" type="date" class="input" />

        <label class="muted" style="margin-top:10px; display:block;">Operador</label>
        <select id="filtro-usuario" class="input">
          <option value="">Todos los operadores</option>
        </select>

        <label class="muted" style="margin-top:10px; display:block;">Tipo</label>
        <select id="filtro-tipo" class="input">
          <option value="">Todos los tipos</option>
          <option value="historias">Historias</option>
          <option value="reels">Reels</option>
          <option value="muro">Muro</option>
          <option value="grupos">Grupos</option>
          <option value="marketplace">Marketplace</option>
        </select>

        <button id="btn-filtrar" class="btn" style="margin-top:12px;">Aplicar</button>
      </div>

      <div class="card" style="margin-top:12px; overflow:auto;">
        <table class="table">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Usuario</th>
              <th>Cuenta</th>
              <th>Tipo</th>
              <th>Link</th>
            </tr>
          </thead>
          <tbody id="tabla-links">
            <tr><td colspan="5" class="muted">Cargando...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- âœ… IMPORTANTE: app.js como mÃ³dulo -->
  <script type="module">
    import { requireSession, loadSidebar, fmtDateISO } from "../../assets/js/app.js";

    const s = requireSession();
    if (!s) throw new Error("Sin sesiÃ³n");

    // âœ… seguridad: solo gerente
    if (s.rol !== "gerente"){
      window.location.replace("../dashboard/dashboard.html");
    }

    await loadSidebar({ activeKey: "verificacion", basePath: "../" });

    // set fecha por defecto hoy
    const f = document.getElementById("filtro-fecha");
    if (f) f.value = fmtDateISO(new Date());
  </script>

  <script src="verificacion.js"></script>
</body>
</html>
